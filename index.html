<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 11 Audio Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
        :root{--win-red:#E81123;--win-bg:rgba(26,26,26,0.9);--glass-stroke:rgba(255,255,255,0.08)}
        body{background-color:#050505;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;font-family:"Segoe UI Variable Text","Segoe UI","Inter",sans-serif;color:white;user-select:none}
        .glass-container{background:var(--win-bg);backdrop-filter:blur(25px) saturate(150%);border:1px solid var(--glass-stroke);box-shadow:0 0 30px rgba(255,0,0,0.15),0 10px 30px rgba(0,0,0,0.5);transition:all 0.5s cubic-bezier(0.2,0.8,0.2,1)}
        .action-rect{width:38px;height:38px;background:var(--win-red);border-radius:10px;display:flex;align-items:center;justify-content:center;transition:all 0.4s cubic-bezier(0.175,0.885,0.32,1.275);box-shadow:0 0 15px rgba(232,17,35,0.4);cursor:pointer}
        .is-recording .action-rect{border-radius:50%;transform:rotate(90deg);background:#ff2e3d}
        .magic-loader{width:20px;height:20px;border:2px solid rgba(255,255,255,0.1);border-left-color:white;border-radius:50%;animation:magic-spin 0.8s cubic-bezier(0.4,0,0.2,1) infinite}
        @keyframes magic-spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
        [data-title]{position:relative}
        [data-title]:hover::after{content:attr(data-title);position:absolute;bottom:-38px;left:50%;transform:translateX(-50%);background:#2b2b2b;color:#d1d1d1;font-size:11px;padding:5px 10px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);white-space:nowrap;z-index:100;box-shadow:0 5px 15px rgba(0,0,0,0.3);pointer-events:none}
        .state-layer{transition:all 0.4s ease}
        .hidden-ui{opacity:0;transform:scale(0.9) translateY(10px);pointer-events:none;position:absolute}
        .visible-ui{opacity:1;transform:scale(1) translateY(0);position:relative}
        .win-tool-btn{padding:0.5rem;border-radius:0.5rem;transition:all 0.2s}
        .win-tool-btn:hover{background:rgba(255,255,255,0.08);color:white}
        .win-tool-btn:active{transform:scale(0.9)}
    </style>
</head>
<body>
    <div class="relative">
        <div id="recorder-ui" class="glass-container visible-ui flex items-center h-[56px] px-3 rounded-[16px] gap-3 min-w-[340px]">
            <div class="flex items-center gap-3 pr-2">
                <div id="main-action-trigger" class="action-rect" data-title="Start Recording">
                    <i id="main-icon" data-lucide="mic" class="w-4 h-4 text-white"></i>
                </div>
                <div class="flex flex-col justify-center">
                    <div class="flex items-center gap-2 leading-none">
                        <span id="timer-display" class="text-lg font-semibold tabular-nums">00:00</span>
                        <div id="live-dot" class="w-1.5 h-1.5 bg-red-500 rounded-full hidden animate-pulse"></div>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-1 ml-auto">
                <button id="pause-btn" class="win-tool-btn text-white/40 opacity-30 cursor-not-allowed" data-title="Pause">
                    <i id="pause-icon" data-lucide="pause" class="w-4 h-4"></i>
                </button>
                <div class="w-[1px] h-5 bg-white/10 mx-1"></div>
                <button id="copy-btn" class="win-tool-btn text-white/60" data-title="Copy Transcript">
                    <i id="copy-icon" data-lucide="copy" class="w-4 h-4"></i>
                </button>
                <div class="w-[1px] h-5 bg-white/10 mx-1"></div>
                <button id="insert-btn" class="win-tool-btn text-white/60" data-title="Smart Insert (Ctrl+V)">
                    <i id="insert-icon" data-lucide="arrow-down" class="w-4 h-4"></i>
                </button>
                <div class="w-[1px] h-5 bg-white/10 mx-1"></div>
                <button id="api-btn" class="win-tool-btn text-white/40" data-title="API Settings">
                    <i data-lucide="key" class="w-4 h-4"></i>
                </button>
                <button id="delete-btn" class="win-tool-btn text-white/30 hover:text-red-400" data-title="Delete">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
        <div id="api-ui" class="glass-container hidden-ui flex items-center h-[56px] px-3 rounded-[16px] gap-3 min-w-[340px]">
            <div class="p-2 text-white/20">
                <i data-lucide="fingerprint" class="w-5 h-5"></i>
            </div>
            <input type="password" id="api-input" placeholder="Paste API Key..." class="bg-transparent flex-1 text-sm text-white border-none outline-none placeholder:text-white/10">
            <div class="flex items-center gap-1">
                <button id="save-api" class="win-tool-btn text-white/60 hover:text-green-400" data-title="Save Key">
                    <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </button>
                <button id="close-api" class="win-tool-btn text-white/20 hover:text-white">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </div>
    <script>
        (()=>{
            let mode='idle',timerSeconds=0,timerInterval=null,lastTranscript="Sample transcribed text from Windows 11 Audio Suite.",mediaRecorder=null,audioChunks=[],apiKey='';
            const recorderUI=document.getElementById('recorder-ui'),apiUI=document.getElementById('api-ui'),mainAction=document.getElementById('main-action-trigger'),mainIcon=document.getElementById('main-icon'),timerDisplay=document.getElementById('timer-display'),liveDot=document.getElementById('live-dot'),pauseBtn=document.getElementById('pause-btn'),copyBtn=document.getElementById('copy-btn'),copyIcon=document.getElementById('copy-icon'),insertBtn=document.getElementById('insert-btn'),insertIcon=document.getElementById('insert-icon'),apiInput=document.getElementById('api-input'),saveApiBtn=document.getElementById('save-api');
            lucide.createIcons();
            window.onload=()=>{apiKey=localStorage.getItem('groqApiKey')||'';if(apiKey)apiInput.value=apiKey};
            mainAction.onclick=()=>mode==='idle'?startRecording():startTranscribing();
            async function startRecording(){try{const stream=await navigator.mediaDevices.getUserMedia({audio:true});let mimeType='audio/webm;codecs=opus';if(MediaRecorder.isTypeSupported('audio/ogg;codecs=opus'))mimeType='audio/ogg;codecs=opus';else if(MediaRecorder.isTypeSupported('audio/webm'))mimeType='audio/webm';mediaRecorder=new MediaRecorder(stream,{mimeType});audioChunks=[];mediaRecorder.ondataavailable=e=>{if(e.data.size>0)audioChunks.push(e.data)};mediaRecorder.onstop=()=>{stream.getTracks().forEach(t=>t.stop())};mediaRecorder.onerror=e=>console.error('MediaRecorder error:',e);mediaRecorder.start(1000);mode='recording';recorderUI.classList.add('is-recording');liveDot.classList.remove('hidden');pauseBtn.classList.remove('opacity-30','cursor-not-allowed');pauseBtn.classList.add('text-white/70');mainAction.setAttribute('data-title','Transcribe');timerInterval=setInterval(()=>{timerSeconds++;const m=Math.floor(timerSeconds/60).toString().padStart(2,'0'),s=(timerSeconds%60).toString().padStart(2,'0');timerDisplay.textContent=`${m}:${s}`},1000)}catch(e){console.error('Error starting recording:',e.name,e.message);handleMicError(e);resetUI()}}
            function handleMicError(e){if(e.name==='NotAllowedError'||e.code===15)alert('Microphone permission was denied. Please allow microphone access in your browser settings and try again.');else if(e.name==='NotFoundError'||e.code===20)alert('No microphone found. Please connect a microphone and try again.');else if(e.name==='NotReadableError'||e.code===21)alert('Microphone is already in use by another application.');else alert('Error accessing microphone: '+e.message)}
            async function startTranscribing(){if(!apiKey){alert('Please set your Groq API key first.');resetUI();return}mode='transcribing';clearInterval(timerInterval);mediaRecorder.stop();await new Promise(r=>setTimeout(r,200));mainAction.innerHTML='<div class="magic-loader"></div>';mainAction.style.background='transparent';mainAction.style.boxShadow='none';mainAction.setAttribute('data-title','Magic is happening...');try{if(audioChunks.length===0)throw new Error('No audio data recorded. Please try recording again.');const totalSize=audioChunks.reduce((a,c)=>a+c.size,0);if(totalSize<1024)throw new Error('Audio recording too short ('+totalSize+' bytes). Please record for at least 1-2 seconds.');const audioBlob=new Blob(audioChunks,{type:mediaRecorder.mimeType});if(audioBlob.size<1024)throw new Error('Final audio blob is too small ('+audioBlob.size+' bytes). Recording may have failed.');const formData=new FormData();formData.append('file',audioBlob,'recording.webm');formData.append('model','whisper-large-v3-turbo');formData.append('temperature','0');formData.append('response_format','verbose_json');const response=await fetch('https://api.groq.com/openai/v1/audio/transcriptions',{method:'POST',headers:{'Authorization':`Bearer ${apiKey}`},body:formData});if(!response.ok){let errorDetails=`API error: ${response.status} ${response.statusText}`;try{const errorBody=await response.text();errorDetails+=` | Response body: ${errorBody}`;console.error('API Error Response:',errorBody)}catch(e){errorDetails+=' | Could not read response body'}throw new Error(errorDetails)}const data=await response.json();lastTranscript=data.text||'No transcript available.';resetUI()}catch(e){console.error('Transcription error:',e.name,e.message);alert('Transcription failed: '+e.message);resetUI()}}
            function resetUI(){mode='idle';timerSeconds=0;clearInterval(timerInterval);timerDisplay.textContent='00:00';recorderUI.classList.remove('is-recording');liveDot.classList.add('hidden');pauseBtn.classList.add('opacity-30','cursor-not-allowed');mainAction.innerHTML='<i id="main-icon" data-lucide="mic" class="w-4 h-4 text-white"></i>';mainAction.style.background='var(--win-red)';mainAction.style.boxShadow='0 0 15px rgba(232,17,35,0.4)';mainAction.setAttribute('data-title','Start Recording');lucide.createIcons()}
            copyBtn.onclick=async()=>{try{await navigator.clipboard.writeText(lastTranscript);copyBtn.classList.add('text-green-400');copyBtn.innerHTML='<i data-lucide="check" class="w-4 h-4"></i>';lucide.createIcons();setTimeout(()=>{copyBtn.classList.remove('text-green-400');copyBtn.innerHTML='<i data-lucide="copy" class="w-4 h-4"></i>';lucide.createIcons()},2000)}catch(e){console.error('Failed to copy text:',e)}}
            insertBtn.onclick=async()=>{if(!lastTranscript||lastTranscript.trim()==='')return;try{if(typeof Neutralino==='undefined'||!Neutralino.os)throw new Error('Neutralinojs native APIs not available');recorderUI.style.opacity='0';recorderUI.style.pointerEvents='none';await new Promise(r=>setTimeout(r,100));const escapedText=lastTranscript.replace(/'/g,"''").replace(/"/g,'\\"').replace(/`/g,'``');const psCommand='$wshell = New-Object -ComObject wscript.shell; Add-Type -AssemblyName PresentationCore; [Windows.Forms.Clipboard]::SetText("'+escapedText+'"); Start-Sleep -Milliseconds 50; $wshell.SendKeys("^v");';await Neutralino.os.runCommand('powershell -Command "'+psCommand+'"',{cwd:''});recorderUI.style.opacity='';recorderUI.style.pointerEvents='';insertBtn.classList.add('text-green-400');insertBtn.innerHTML='<i data-lucide="check" class="w-4 h-4"></i>';lucide.createIcons();const origTitle=insertBtn.getAttribute('data-title');insertBtn.setAttribute('data-title','Inserted!');setTimeout(()=>{insertBtn.classList.remove('text-green-400');insertBtn.innerHTML='<i id="insert-icon" data-lucide="arrow-down" class="w-4 h-4"></i>';insertBtn.setAttribute('data-title',origTitle);lucide.createIcons()},2000)}catch(e){console.error('Smart Insert error:',e);recorderUI.style.opacity='';recorderUI.style.pointerEvents='';if(e.message.includes('Neutralinojs native APIs not available')){try{await navigator.clipboard.writeText(lastTranscript);alert('Text copied to clipboard! Manually paste (Ctrl+V) into your target application.')}catch(c){alert('Smart Insert failed. Please copy the transcript and paste manually.')}}else{alert('Smart Insert failed: '+e.message+'. Please copy and paste manually.')}}}
            document.getElementById('api-btn').onclick=()=>{recorderUI.classList.replace('visible-ui','hidden-ui');apiUI.classList.replace('hidden-ui','visible-ui');setTimeout(()=>document.getElementById('api-input').focus(),300)};
            document.getElementById('close-api').onclick=()=>{apiUI.classList.replace('visible-ui','hidden-ui');recorderUI.classList.replace('hidden-ui','visible-ui')};
            saveApiBtn.onclick=function(){apiKey=apiInput.value.trim();if(apiKey){localStorage.setItem('groqApiKey',apiKey);this.innerHTML='<i data-lucide="check" class="w-4 h-4 text-green-500"></i>';lucide.createIcons();setTimeout(()=>{document.getElementById('close-api').click();this.innerHTML='<i data-lucide="arrow-right" class="w-4 h-4"></i>';lucide.createIcons()},800)}else{alert('Please enter a valid API key.')}};
            document.getElementById('delete-btn').onclick=resetUI;
        })();
    </script>
</body>
</html>
